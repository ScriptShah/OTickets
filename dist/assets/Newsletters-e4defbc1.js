import{d as J,b as t,G as j,f as K,E as A,m as B,i,h as s,o as v,g as r,a as l,w as oe,y as le,u as re,z as G,q as ne,c as C,n as ue,v as ie,F as H,l as ce,k as de,x as pe,j as L,t as M}from"./index-28d7808a.js";import{_ as me,a as h,b as fe,T as ve}from"./TableSkeleton-b5bcf82c.js";import{_ as ye}from"./ActionButton.vue_vue_type_script_setup_true_lang-a5ee823d.js";import{_ as _e,a as ge,b as we,r as he}from"./ExclamationTriangleIcon-54e3cae4.js";import{r as be,_ as xe}from"./PlusIcon-1afde447.js";import{_ as qe,a as ke}from"./PrimaryButton.vue_vue_type_script_setup_true_lang-a98f89af.js";import{u as Q}from"./useNewsletters-6ec1c390.js";import{r as $e}from"./MagnifyingGlassIcon-7b7d515e.js";import{a as Ne}from"./global-6426d760.js";import{u as Te}from"./dashboard-51967606.js";import{l as Ee}from"./lodash-00fe4291.js";import{M as P}from"./menu-880c2858.js";import"./ChevronRightIcon-af9613bc.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./EllipsisHorizontalIcon-f2ab61ca.js";import"./SectionHeader.vue_vue_type_script_setup_true_lang-7b13873f.js";import"./XMarkIcon-cf8614b7.js";import"./transition-d11ecd8d.js";import"./use-tracked-pointer-3831155a.js";import"./dialog-4ee4193f.js";import"./emptyResults-4bcd933a.js";import"./FormLabel.vue_vue_type_script_setup_true_lang-7c85f56e.js";import"./vue.runtime.esm-bundler-e8cc2f2c.js";const Ce=["onSubmit"],Me={class:"p-6"},Be={class:"mt-3 flex justify-end border-t bg-gray-50 px-6 py-3"},Se=J({__name:"NewsletterModal",props:{open:{type:Boolean},newsletterToEdit:null},emits:["close","success"],setup(b,{emit:m}){const n=b,o=t(""),d=j(()=>n.newsletterToEdit.id?"put":"post"),u=t(!1),$=j(()=>n.newsletterToEdit.id?"Edit Newsletter":"New Newsletter"),c=j(()=>n.newsletterToEdit.id?"Update":"Create"),g=K(),{save:x,isLoading:S,isSuccess:w,errors:I,message:y}=Q(),q=()=>{u.value=!0,o.value=""},N=async()=>{await x(o.value,d.value,n.newsletterToEdit.id??null),w.value?(g.success(y.value),q(),d.value==="post"?m("success",!1):m("success",!0),m("close")):g.error(y.value)};return A(()=>n.newsletterToEdit,()=>{n.newsletterToEdit.id?o.value=n.newsletterToEdit.email:q()}),(T,p)=>(v(),B(_e,{open:b.open,onClose:p[2]||(p[2]=k=>T.$emit("close")),title:s($)},{default:i(()=>[r("form",{onSubmit:oe(N,["prevent"])},[r("div",Me,[l(qe,{class:"w-full",id:"email",label:"Email",placeholder:"Email",type:"email",value:o.value,onChange:p[0]||(p[0]=k=>o.value=k),errors:s(I).email,reset:u.value,onReset:p[1]||(p[1]=()=>u.value=!1)},null,8,["value","errors","reset"])]),r("div",Be,[l(ke,{type:"submit",text:s(c),loading:s(S)},null,8,["text","loading"])])],40,Ce)]),_:1},8,["open","title"]))}}),Ie=(b=t({}))=>{const m=t({}),n=t(!1),o=t(!1);return{load:async()=>{o.value=!0,await le.get("/newsletters",{params:b.value}).then(u=>m.value=u.data.data).catch(()=>n.value=!0).then(()=>o.value=!1)},newsletters:m,error:n,isLoading:o}},De={class:"mb-3 flex flex-col justify-between gap-3 sm:flex-row-reverse"},je={class:"flex justify-end sm:justify-start"},Le={class:"w-full max-w-sm"},Ae=r("label",{for:"search",class:"sr-only"},"Search",-1),Re={class:"relative rounded-md shadow-sm"},Ue={class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},Ve=["title"],Fe=["onClick"],Oe=["onClick"],ze={key:1},Ge=r("p",{class:"p-6 text-center text-xl"},"No newsletters yet",-1),ft=J({__name:"Newsletters",setup(b){re({title:`Newsletters | ${Ne}`});const{setTitle:m}=Te();m("Newsletters");const n=["Email","IP","User Agent","Created At",""],o=ce(),d=t({page:isNaN(Number(o.query.page))?null:Number(o.query.page),query:o.query.query??null,paginate:!0}),{load:u,isLoading:$,newsletters:c}=Ie(d),g=t(o.query.query??""),x=de();A(g,Ee.debounce(async function(e){d.value.query=e;const a={};e&&(a.query=e),x.push({query:a})},300));const S=t(!!(o.query.trash??!1));A(S,e=>{const a={};e&&(a.trash=e),x.push({query:a})}),G(async(e,a,E)=>{(e.query.query!==a.query.query||e.query.trash!==a.query.trash)&&await u(),E()}),ne(async()=>{await u()});const w=t(!1),I=async e=>{Object.keys(o.query).length?e?await u():x.push({query:{}}):await u()},y=t(!1),q=t(""),N=t(""),T=t(""),p=t(""),k=t(""),R=t(""),U=t({}),V=t({}),{destroy:W,message:F,isSuccess:X,isLoading:Y}=Q(),Z=()=>{D.value={},w.value=!0},D=t({}),ee=e=>{D.value=e,w.value=!0},O=t({}),te=e=>{O.value=e,y.value=!0,q.value="Delete Newsletter",N.value="Are you sure you want to delete this newsletter?",T.value="Delete",p.value="bg-red-100",k.value="bg-red-600 hover:bg-red-700 focus:ring-red-500",R.value="text-red-600",U.value=he,V.value=se},z=K(),se=async()=>{await W(O.value.id),y.value=!1,X.value?(z.success(F.value),await u()):z.error(F.value)};return G(async(e,a)=>{e.query.page&&e.query.page!==a.query.page&&(d.value={...d.value,page:+e.query.page}),await u()}),(e,a)=>{var E;return v(),C(H,null,[l(Se,{open:w.value,newsletterToEdit:D.value,onClose:a[0]||(a[0]=_=>w.value=!1),onSuccess:I},null,8,["open","newsletterToEdit"]),l(ge,{title:q.value,open:y.value,text:N.value,"button-text":T.value,"is-loading":s(Y),Icon:U.value,color:R.value,"background-color":p.value,onClose:a[1]||(a[1]=_=>y.value=!1),onConfirm:a[2]||(a[2]=_=>V.value()),"button-background-color":k.value},null,8,["title","open","text","button-text","is-loading","Icon","color","background-color","button-background-color"]),r("header",De,[r("div",je,[l(ye,{Icon:s(be),text:"New Newsletter",action:Z},null,8,["Icon"])]),r("div",Le,[Ae,r("div",Re,[r("div",Ue,[l(s($e),{class:"h-5 w-5 text-gray-400"})]),ue(r("input",{"onUpdate:modelValue":a[3]||(a[3]=_=>g.value=_),type:"search",name:"search",id:"search",class:"block w-full rounded-md border-gray-300 pl-10 text-sm focus:border-teal-500 focus:ring-teal-500",placeholder:"Search"},null,512),[[ie,g.value]])])])]),s($)?(v(),B(ve,{key:0})):!s($)&&!((E=s(c).data)!=null&&E.length)&&d.value.query?(v(),B(xe,{key:1,text:"No newsletters related to your search"})):(v(),B(me,{key:2,headers:n},{default:i(()=>{var _;return[(_=s(c).data)!=null&&_.length?(v(!0),C(H,{key:0},pe(s(c).data,f=>(v(),C("tr",{key:f.id},[l(h,null,{default:i(()=>[L(M(f.email),1)]),_:2},1024),l(h,null,{default:i(()=>[L(M(f.ip_address??"--"),1)]),_:2},1024),l(h,null,{default:i(()=>[r("p",{class:"w-96 truncate",title:f.user_agent??"--"},M(f.user_agent??"--"),9,Ve)]),_:2},1024),l(h,null,{default:i(()=>[L(M(f.created_at),1)]),_:2},1024),l(h,null,{default:i(()=>[l(we,null,{default:i(()=>[l(s(P),{class:"cursor-pointer"},{default:i(()=>[r("div",{onClick:ae=>ee(f),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," Edit ",8,Fe)]),_:2},1024),l(s(P),{class:"cursor-pointer"},{default:i(()=>[r("div",{onClick:ae=>te(f),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," Delete ",8,Oe)]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128)):(v(),C("tr",ze,[l(h,{colspan:"5"},{default:i(()=>[Ge]),_:1})]))]}),pagination:i(()=>[l(fe,{class:"border-t bg-gray-50 py-2 px-3",from:s(c).from,to:s(c).to,total:s(c).total,prev_page_url:s(c).prev_page_url,next_page_url:s(c).next_page_url,links:s(c).links,"route-name":"DashboardNewsletters",query:{query:e.$route.query.query}},null,8,["from","to","total","prev_page_url","next_page_url","links","query"])]),_:1}))],64)}}});export{ft as default};
