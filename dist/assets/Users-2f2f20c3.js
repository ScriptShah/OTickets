import{b as r,y as ie,d as de,G,f as ce,E as te,m as P,i as q,h as o,o as T,g as u,a as n,A as ue,w as ke,q as pe,u as Te,z as Ce,c as V,n as Ue,v as Ne,F as Z,l as Ee,k as Re,x as Se,t as J,j as oe}from"./index-28d7808a.js";import{_ as De,a as z,b as Ie,T as Ae}from"./TableSkeleton-b5bcf82c.js";import{_ as Pe,a as Me,b as Le,r as ve}from"./ExclamationTriangleIcon-54e3cae4.js";import{_ as F,b as Be,a as je}from"./PrimaryButton.vue_vue_type_script_setup_true_lang-a98f89af.js";import{_ as me}from"./ListBox.vue_vue_type_script_setup_true_lang-9258f04c.js";import{_ as fe}from"./Autocomplete.vue_vue_type_script_setup_true_lang-30be75d0.js";import{_ as Oe}from"./FormLabel.vue_vue_type_script_setup_true_lang-7c85f56e.js";import{_ as Ve,a as ze,d as Ge,r as He}from"./debounce-fafd0e7f.js";import{_ as Je}from"./DatesPicker.vue_vue_type_script_setup_true_lang-c68c7fba.js";import{_ as Ke}from"./ActionButton.vue_vue_type_script_setup_true_lang-a5ee823d.js";import{r as Qe,_ as We}from"./PlusIcon-1afde447.js";import{r as Xe}from"./MagnifyingGlassIcon-7b7d515e.js";import{r as Ye}from"./InformationCircleIcon-4d06df1d.js";import{a as Ze}from"./global-6426d760.js";import{u as Fe}from"./dashboard-51967606.js";import{g as et}from"./getUsers-cc3347f2.js";import{g as tt}from"./getDepartments-3ecae0aa.js";import{M as ee}from"./menu-880c2858.js";import"./ChevronRightIcon-af9613bc.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./EllipsisHorizontalIcon-f2ab61ca.js";import"./SectionHeader.vue_vue_type_script_setup_true_lang-7b13873f.js";import"./XMarkIcon-cf8614b7.js";import"./transition-d11ecd8d.js";import"./use-tracked-pointer-3831155a.js";import"./dialog-4ee4193f.js";import"./vue.runtime.esm-bundler-e8cc2f2c.js";import"./use-controllable-fce04192.js";import"./combobox-f45cc6e0.js";import"./switch-6008f224.js";import"./emptyResults-4bcd933a.js";const ne=r({}),M=r(""),L=r(!1),B=r(!1),at=async(b,g,t=null)=>{ne.value={},L.value=!0,B.value=!1;const e={"Content-Type":"multipart/form-data"},p=t?`/users/${t}`:"/users";await ie.post(p,{...b,_method:g},{headers:e}).then(i=>{M.value=i.data.message,B.value=!0}).catch(i=>{var x,d,C;ne.value=(x=i.response)==null?void 0:x.data.errors,((d=i.response)==null?void 0:d.status)===422?M.value="Please check the errors":M.value=(C=i.response)==null?void 0:C.data.message}).then(()=>{L.value=!1})},st=async b=>{L.value=!0,B.value=!1,await ie.put(`/users/${b}/restore`).then(g=>{M.value=g.data.message,B.value=!0}).catch(g=>{var t;M.value=(t=g.response)==null?void 0:t.data.message}).then(()=>{L.value=!1})},lt=async(b,g=!1)=>{L.value=!0,B.value=!1;const t=g?`/users/${b}/force-delete`:`/users/${b}`;await ie.delete(t).then(e=>{M.value=e.data.message,B.value=!0}).catch(e=>{var p;M.value=(p=e.response)==null?void 0:p.data.message}).then(()=>{L.value=!1})},ye=()=>({errors:ne,isLoading:L,isSuccess:B,message:M,save:at,destroy:lt,restore:st}),rt=["onSubmit"],ot={class:"space-y-4 p-6"},ut={class:"flex flex-col gap-4 sm:flex-row"},nt={class:"flex flex-col gap-4 sm:flex-row"},it={class:"flex flex-wrap items-center gap-3"},dt=["src"],vt=u("label",{for:"profile-picture",class:"cursor-pointer rounded-md border border-gray-300 py-2 px-3 text-sm font-medium text-gray-700 hover:bg-gray-100"}," Change ",-1),ct={class:"mt-3 flex justify-end border-t bg-gray-50 px-6 py-3"},pt=de({__name:"UserModal",props:{open:{type:Boolean},departments:null,userToEdit:null},emits:["close","success"],setup(b,{emit:g}){const t=b,e=r(""),p=r(""),i=r(""),x=r(""),d=r({}),C=r({}),E=r({}),R=r([{name:"Agent",value:"agent"},{name:"Admin",value:"admin"}]),c=G(()=>t.userToEdit.id?"put":"post"),v=G(()=>{var w;return((w=d.value)==null?void 0:w.value)==="agent"}),_={}.VITE_API_URL,h=_+"storage/examples/user.jpg",f=r(h),S=w=>{const a=w.target.files[0];f.value=URL.createObjectURL(a),E.value=a},m=r(!1),D=G(()=>t.userToEdit.id?"Edit User":"New User"),I=G(()=>t.userToEdit.id?"Update":"Create"),A=ce(),{save:ae,isLoading:H,isSuccess:se,errors:U,message:K}=ye(),Q=()=>{m.value=!0,e.value="",p.value="",i.value="",x.value="",d.value={},C.value={},E.value={},f.value=h},W=async()=>{var a,y,X;const w=isNaN(Number((a=C.value)==null?void 0:a.value))?null:Number((y=C.value)==null?void 0:y.value);await ae({name:e.value,email:p.value,phone:i.value,password:x.value,role:(X=d.value)==null?void 0:X.value,department_id:v.value?w:null,picture:E.value},c.value,t.userToEdit.id??null),se.value?(A.success(K.value),Q(),c.value==="post"?g("success",!1):g("success",!0),g("close")):A.error(K.value)};return te(()=>t.userToEdit,()=>{t.userToEdit.id?(e.value=t.userToEdit.name,p.value=t.userToEdit.email,i.value=t.userToEdit.phone,d.value=R.value.find(w=>w.value===t.userToEdit.role)??{},f.value=_+t.userToEdit.picture):Q()}),te(()=>t.departments&&t.userToEdit,()=>{t.userToEdit.id&&(C.value=t.departments.find(w=>{var a;return w.value===((a=t.userToEdit.department)==null?void 0:a.id.toString())})??{})}),(w,a)=>(T(),P(Pe,{open:b.open,onClose:a[12]||(a[12]=y=>w.$emit("close")),title:o(D)},{default:q(()=>[u("form",{onSubmit:ke(W,["prevent"])},[u("div",ot,[u("div",ut,[n(F,{class:"w-full",id:"name",label:"Name",placeholder:"Name",type:"text",value:e.value,onChange:a[0]||(a[0]=y=>e.value=y),errors:o(U).name,reset:m.value,onReset:a[1]||(a[1]=()=>m.value=!1)},null,8,["value","errors","reset"]),n(F,{class:"w-full",id:"email",label:"Email",placeholder:"Email",type:"email",value:p.value,onChange:a[2]||(a[2]=y=>p.value=y),errors:o(U).email,reset:m.value,onReset:a[3]||(a[3]=()=>m.value=!1)},null,8,["value","errors","reset"])]),u("div",nt,[n(F,{class:"w-full",id:"phone",label:"Phone",placeholder:"Phone",type:"tel",value:i.value,onChange:a[4]||(a[4]=y=>i.value=y),errors:o(U).phone,reset:m.value,onReset:a[5]||(a[5]=()=>m.value=!1)},null,8,["value","errors","reset"]),n(F,{class:"w-full",id:"password",label:"Password",placeholder:"Password",type:"password",onChange:a[6]||(a[6]=y=>x.value=y),errors:o(U).password,reset:m.value,onReset:a[7]||(a[7]=()=>m.value=!1)},null,8,["errors","reset"])]),n(me,{"null-text":"Select a role",class:"w-full",label:"Role",selected:d.value,options:R.value,onUpdate:a[8]||(a[8]=y=>d.value=y),errors:o(U).role,reset:m.value,onReset:a[9]||(a[9]=()=>m.value=!1)},null,8,["selected","options","errors","reset"]),o(v)?(T(),P(fe,{key:0,"null-text":"Select a department",class:"w-full",label:"Department",selected:C.value,options:b.departments,onUpdate:a[10]||(a[10]=y=>C.value=y),errors:o(U).department_id,reset:m.value,onReset:a[11]||(a[11]=()=>m.value=!1)},null,8,["selected","options","errors","reset"])):ue("",!0),u("div",null,[n(Oe,{text:"Picture",id:"profile-picture"}),u("div",it,[u("img",{class:"relative h-20 w-20 rounded-full border object-cover",src:f.value,alt:"Profile Picture"},null,8,dt),u("div",null,[vt,u("input",{ref:"temp",onChange:S,type:"file",id:"profile-picture",class:"hidden"},null,544)])]),o(U).picture?(T(),P(Be,{key:0,errors:o(U).picture},null,8,["errors"])):ue("",!0)])]),u("div",ct,[n(je,{type:"submit",text:o(I),loading:o(H)},null,8,["text","loading"])])],40,rt)]),_:1},8,["open","title"]))}}),mt={class:"relative mt-6 flex-1 space-y-6 px-4 sm:px-6"},ft=de({__name:"FilterUsers",props:{open:{type:Boolean},filters:null,departments:null},emits:["close","reset","filter"],setup(b,{emit:g}){const t=b,e=[{name:"Admin",value:"admin"},{name:"Agent",value:"agent"}],p=r({}),i=r({}),x=r(!1);pe(async()=>{var c,v;t.filters.role&&(p.value=e.find(_=>{var h;return _.value===((h=t.filters.role)==null?void 0:h.toString())})),t.filters.dates&&(d.value=[new Date((c=t.filters.dates)==null?void 0:c[0]),new Date((v=t.filters.dates)==null?void 0:v[1])]),t.filters.trash&&(x.value=t.filters.trash.toString()=="true")}),te(()=>t.departments,()=>{t.filters.department&&(i.value=t.departments.find(c=>{var v;return c.value===((v=t.filters.department)==null?void 0:v.toString())}))});const d=r([]),C=G(()=>{var c;return((c=p.value)==null?void 0:c.value)!=="admin"}),E=()=>{var _,h,f,S,m,D,I;const c=isNaN(Number((_=i.value)==null?void 0:_.value))?null:Number((h=i.value)==null?void 0:h.value),v={trash:x.value,role:((f=p.value)==null?void 0:f.value)??null,department:C.value?c:null,dates:[((m=(S=d.value)==null?void 0:S[0])==null?void 0:m.toISOString().slice(0,10))??null,((I=(D=d.value)==null?void 0:D[1])==null?void 0:I.toISOString().slice(0,10))??null]};g("filter",v)},R=()=>{x.value=!1,p.value={},i.value={},d.value=[],g("reset")};return(c,v)=>(T(),P(Ve,{filter:E,reset:R,open:b.open,onClose:v[4]||(v[4]=_=>c.$emit("close"))},{default:q(()=>{var _,h;return[u("div",mt,[n(ze,{label:"Trash",value:x.value,onChange:v[0]||(v[0]=f=>x.value=f)},null,8,["value"]),n(me,{onUpdate:v[1]||(v[1]=f=>p.value=f),label:"Role",options:e,selected:p.value,"null-text":"All"},null,8,["selected"]),((_=p.value)==null?void 0:_.value)==="agent"||!((h=p.value)!=null&&h.value)?(T(),P(fe,{key:0,onUpdate:v[2]||(v[2]=f=>i.value=f),label:"Department",options:b.departments,selected:i.value,"null-text":"All"},null,8,["options","selected"])):ue("",!0),n(Je,{onUpdate:v[3]||(v[3]=f=>d.value=f),dates:d.value},null,8,["dates"])])]}),_:1},8,["open"]))}}),yt={class:"mb-3 flex flex-col justify-between gap-3 sm:flex-row-reverse"},gt={class:"flex justify-end sm:justify-start"},_t={class:"flex flex-1 gap-3"},ht={class:"w-full max-w-sm"},bt=u("label",{for:"search",class:"sr-only"},"Search",-1),xt={class:"relative rounded-md shadow-sm"},$t={class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},qt=u("span",null,"Filter",-1),wt={class:"flex items-center gap-2"},kt={class:"h-10 w-10 flex-shrink-0"},Tt=["src"],Ct={class:"font-medium text-gray-900"},Ut={class:"text-gray-500"},Nt=["onClick"],Et=["onClick"],Rt=["onClick"],St=["onClick"],Dt={key:1},It=u("p",{class:"p-6 text-center text-xl"},"No users yet",-1),ca=de({__name:"Users",setup(b){Te({title:`Users | ${Ze}`});const{setTitle:g}=Fe();g("Users");const t=Ee(),e=r({page:isNaN(Number(t.query.page))?null:Number(t.query.page),query:t.query.query??null,department:isNaN(Number(t.query.department))?null:Number(t.query.department),trash:t.query.trash,role:t.query.role??null,dates:t.query.from&&t.query.to?[t.query.from,t.query.to]:null,paginate:!0}),p=G(()=>e.value.query||e.value.department||e.value.role||e.value.dates||e.value.trash),{load:i,isLoading:x,paginatedUsers:d}=et(e),C=async s=>{Object.keys(t.query).length?s?await i():Y.push({query:{}}):await i()},E=r([]);pe(async()=>{await i();const{load:s,departments:l}=tt();await s(),E.value=l.value.map(k=>({name:k.name,value:k.id.toString()}))});const R=r(!1),c=r(!1),v=r(""),_=r(""),h=r(""),f=r(""),S=r(""),m=r(""),D=r({}),I=r({}),A=r(!1),ae=()=>{H.value={},R.value=!0},H=r({}),se=s=>{H.value=s,R.value=!0},U=r({}),K=s=>{U.value=s,c.value=!0,v.value="Delete User",_.value="Are you sure you want to delete this user?",h.value="Delete",f.value="bg-red-100",S.value="bg-red-600 hover:bg-red-700 focus:ring-red-500",m.value="text-red-600",D.value=ve,I.value=_e},Q=s=>{U.value=s,c.value=!0,v.value="Permanent Delete User",_.value="Are you sure you want to permanently delete this user? This action cannot be undone.",h.value="Delete",f.value="bg-red-100",S.value="bg-red-600 hover:bg-red-700 focus:ring-red-500",m.value="text-red-600",D.value=ve,I.value=he},W=r({}),w=s=>{W.value=s,c.value=!0,v.value="Restore User",_.value="Are you sure you want to restore this user?",h.value="Restore",f.value="bg-teal-100",S.value="bg-teal-600 hover:bg-teal-700 focus:ring-teal-500",m.value="text-teal-600",D.value=Ye,I.value=be},a=ce(),{destroy:y,restore:X,isLoading:ge,message:j,isSuccess:le}=ye(),_e=async()=>{await y(U.value.id),c.value=!1,le.value?(a.success(j.value),await i()):a.error(j.value)},he=async()=>{await y(U.value.id,!0),c.value=!1,le.value?(a.success(j.value),await i()):a.error(j.value)},be=async()=>{await X(W.value.id),c.value=!1,le.value?(a.success(j.value),await i()):a.error(j.value)},xe=["User","Role","Department","Created At",""],$e={}.VITE_API_URL,Y=Re(),re=r(e.value.query??"");te(re,Ge(async function(s){var k,$;e.value.query=s;const l={};s&&(l.query=s),e.value.trash&&(l.trash=e.value.trash),e.value.department&&(l.department=e.value.department),e.value.role&&(l.role=e.value.role),(k=e.value.dates)!=null&&k[0]&&(($=e.value.dates)!=null&&$[1])&&(l.from=e.value.dates[0],l.to=e.value.dates[1]),Y.push({query:l})},300));const qe=async s=>{var k,$;A.value=!1,e.value={...s,query:e.value.query,paginate:!0};const l={};l.trash=s.trash,e.value.query&&(l.query=e.value.query),s.role&&(l.role=s.role),s.department&&(l.department=s.department),(k=s.dates)!=null&&k[0]&&(($=s.dates)!=null&&$[1])&&(l.from=s.dates[0],l.to=s.dates[1]),Y.push({query:l})},we=async()=>{var s,l;if(A.value=!1,e.value.trash||e.value.role||e.value.department||(s=e.value.dates)!=null&&s[0]&&((l=e.value.dates)!=null&&l[1])){const k={};e.value.query?(e.value={query:e.value.query,paginate:!0},k.query=e.value.query):e.value={paginate:!0},Y.push({query:k})}};return Ce(async(s,l)=>{s.query.page&&s.query.page!==l.query.page&&(e.value={...e.value,page:+s.query.page}),await i()}),(s,l)=>{var k;return T(),V(Z,null,[n(pt,{open:R.value,departments:E.value,"user-to-edit":H.value,onClose:l[0]||(l[0]=$=>R.value=!1),onSuccess:C},null,8,["open","departments","user-to-edit"]),n(Me,{title:v.value,open:c.value,text:_.value,"button-text":h.value,"is-loading":o(ge),Icon:D.value,color:m.value,"background-color":f.value,onClose:l[1]||(l[1]=$=>c.value=!1),onConfirm:l[2]||(l[2]=$=>I.value()),"button-background-color":S.value},null,8,["title","open","text","button-text","is-loading","Icon","color","background-color","button-background-color"]),n(ft,{departments:E.value,filters:e.value,open:A.value,onClose:l[3]||(l[3]=$=>A.value=!1),onFilter:qe,onReset:we},null,8,["departments","filters","open"]),u("header",yt,[u("div",gt,[n(Ke,{Icon:o(Qe),text:"New User",action:ae},null,8,["Icon"])]),u("div",_t,[u("div",ht,[bt,u("div",xt,[u("div",$t,[n(o(Xe),{class:"h-5 w-5 text-gray-400"})]),Ue(u("input",{"onUpdate:modelValue":l[4]||(l[4]=$=>re.value=$),type:"search",name:"search",id:"search",class:"block w-full rounded-md border-gray-300 pl-10 text-sm focus:border-teal-500 focus:ring-teal-500",placeholder:"Search"},null,512),[[Ne,re.value]])])]),u("button",{onClick:l[5]||(l[5]=$=>A.value=!0),type:"button",class:"relative -ml-px inline-flex items-center space-x-2 rounded-md border border-gray-300 bg-gray-50 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 focus:border-teal-500 focus:outline-none focus:ring-1 focus:ring-teal-500"},[n(o(He),{class:"h-5 w-5 text-gray-400"}),qt])])]),o(x)?(T(),P(Ae,{key:0})):!o(x)&&!((k=o(d).data)!=null&&k.length)&&o(p)?(T(),P(We,{key:1,text:"No users related to your search"})):(T(),P(De,{key:2,headers:xe},{default:q(()=>{var $;return[($=o(d).data)!=null&&$.length?(T(!0),V(Z,{key:0},Se(o(d).data,N=>(T(),V("tr",{key:N.id},[n(z,null,{default:q(()=>[u("div",wt,[u("div",kt,[u("img",{class:"h-10 w-10 rounded-full",src:o($e)+N.picture,alt:"Profile Picture"},null,8,Tt)]),u("div",null,[u("div",Ct,J(N.name),1),u("div",Ut,J(N.email),1)])])]),_:2},1024),n(z,null,{default:q(()=>[oe(J(N.role),1)]),_:2},1024),n(z,null,{default:q(()=>{var O;return[oe(J(N.role==="agent"?(O=N.department)==null?void 0:O.name:"--"),1)]}),_:2},1024),n(z,null,{default:q(()=>[oe(J(N.created_at),1)]),_:2},1024),n(z,null,{default:q(()=>[n(Le,null,{default:q(()=>[s.$route.query.trash!="true"?(T(),V(Z,{key:0},[n(o(ee),{class:"cursor-pointer"},{default:q(()=>[u("div",{onClick:O=>se(N),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," Edit ",8,Nt)]),_:2},1024),n(o(ee),{class:"cursor-pointer"},{default:q(()=>[u("div",{onClick:O=>K(N),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," Delete ",8,Et)]),_:2},1024)],64)):(T(),V(Z,{key:1},[n(o(ee),{class:"cursor-pointer"},{default:q(()=>[u("div",{onClick:O=>w(N),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," Restore ",8,Rt)]),_:2},1024),n(o(ee),{class:"cursor-pointer"},{default:q(()=>[u("div",{onClick:O=>Q(N),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," Delete permanently ",8,St)]),_:2},1024)],64))]),_:2},1024)]),_:2},1024)]))),128)):(T(),V("tr",Dt,[n(z,{colspan:"5"},{default:q(()=>[It]),_:1})]))]}),pagination:q(()=>[n(Ie,{class:"border-t bg-gray-50 py-2 px-3",from:o(d).from,to:o(d).to,total:o(d).total,prev_page_url:o(d).prev_page_url,next_page_url:o(d).next_page_url,links:o(d).links,"route-name":"DashboardUsers",query:{trash:s.$route.query.trash,query:s.$route.query.query,department:s.$route.query.department,role:s.$route.query.role,from:s.$route.query.from,to:s.$route.query.to}},null,8,["from","to","total","prev_page_url","next_page_url","links","query"])]),_:1}))],64)}}});export{ca as default};
