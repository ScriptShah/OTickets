import{b as r,y as se,d as le,G as X,f as de,E as ve,m as R,i as m,h as o,o as b,g as s,a as n,A as we,w as ke,q as pe,u as Te,z as De,c as F,n as ue,v as Ee,F as J,l as Ie,k as Re,x as Se,t as K,j as ie,r as Pe,B as Me}from"./index-28d7808a.js";import{_ as Ne,a as z,b as Ae,T as Be}from"./TableSkeleton-b5bcf82c.js";import{_ as Le,a as Ue,b as je,r as ce}from"./ExclamationTriangleIcon-54e3cae4.js";import{_ as Q,b as Oe,a as Ve}from"./PrimaryButton.vue_vue_type_script_setup_true_lang-a98f89af.js";import{_ as Fe}from"./FormLabel.vue_vue_type_script_setup_true_lang-7c85f56e.js";import{_ as ze,a as Ge,d as He,r as Je}from"./debounce-fafd0e7f.js";import{_ as Ke}from"./DatesPicker.vue_vue_type_script_setup_true_lang-c68c7fba.js";import{_ as Qe}from"./ActionButton.vue_vue_type_script_setup_true_lang-a5ee823d.js";import{r as We,_ as Xe}from"./PlusIcon-1afde447.js";import{r as Ye}from"./MagnifyingGlassIcon-7b7d515e.js";import{r as Ze}from"./InformationCircleIcon-4d06df1d.js";import{a as et}from"./global-6426d760.js";import{u as tt}from"./dashboard-51967606.js";import{g as at}from"./getClients-3787ad9e.js";import{g as st}from"./getDepartments-3ecae0aa.js";import{M as W}from"./menu-880c2858.js";import"./ChevronRightIcon-af9613bc.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./EllipsisHorizontalIcon-f2ab61ca.js";import"./SectionHeader.vue_vue_type_script_setup_true_lang-7b13873f.js";import"./XMarkIcon-cf8614b7.js";import"./transition-d11ecd8d.js";import"./use-tracked-pointer-3831155a.js";import"./dialog-4ee4193f.js";import"./vue.runtime.esm-bundler-e8cc2f2c.js";import"./switch-6008f224.js";import"./use-controllable-fce04192.js";import"./emptyResults-4bcd933a.js";const ae=r({}),D=r(""),S=r(!1),P=r(!1),lt=async(_,p,a=null)=>{ae.value={},S.value=!0,P.value=!1;const e={"Content-Type":"multipart/form-data"},v=a?`/clients/${a}`:"/clients";await se.post(v,{..._,_method:p},{headers:e}).then(c=>{D.value=c.data.message,P.value=!0}).catch(c=>{var C,u,d;ae.value=(C=c.response)==null?void 0:C.data.errors,((u=c.response)==null?void 0:u.status)===422?D.value="Please check the errors":D.value=(d=c.response)==null?void 0:d.data.message}).then(()=>{S.value=!1})},ot=async _=>{S.value=!0,P.value=!1,await se.put(`/clients/${_}/restore`).then(p=>{D.value=p.data.message,P.value=!0}).catch(p=>{var a;D.value=(a=p.response)==null?void 0:a.data.message}).then(()=>{S.value=!1})},rt=async(_,p=!1)=>{S.value=!0,P.value=!1;const a=p?`/clients/${_}/force-delete`:`/clients/${_}`;await se.delete(a).then(e=>{D.value=e.data.message,P.value=!0}).catch(e=>{var v;D.value=(v=e.response)==null?void 0:v.data.message}).then(()=>{S.value=!1})},fe=()=>({errors:ae,isLoading:S,isSuccess:P,message:D,save:lt,destroy:rt,restore:ot}),nt=["onSubmit"],ut={class:"space-y-4 p-6"},it={class:"flex flex-col gap-4 sm:flex-row"},ct={class:"flex flex-col gap-4 sm:flex-row"},dt={class:"flex flex-wrap items-center gap-3"},vt=["src"],pt=s("label",{for:"profile-picture",class:"cursor-pointer rounded-md border border-gray-300 py-2 px-3 text-sm font-medium text-gray-700 hover:bg-gray-100"}," Change ",-1),ft={class:"mt-3 flex justify-end border-t bg-gray-50 px-6 py-3"},mt=le({__name:"ClientModal",props:{open:{type:Boolean},clientToEdit:null},emits:["close","success"],setup(_,{emit:p}){const a=_,e=r(""),v=r(""),c=r(""),C=r(""),u=r({}),d=X(()=>a.clientToEdit.id?"put":"post"),y={}.VITE_API_URL,q=y+"storage/examples/user.jpg",f=r(q),M=T=>{const i=T.target.files[0];f.value=URL.createObjectURL(i),u.value=i},g=r(!1),N=X(()=>a.clientToEdit.id?"Edit Client":"New Client"),A=X(()=>a.clientToEdit.id?"Update":"Create"),E=de(),{save:B,isLoading:L,isSuccess:U,errors:x,message:G}=fe(),j=()=>{g.value=!0,e.value="",v.value="",c.value="",C.value="",u.value={},f.value=q},Y=async()=>{await B({name:e.value,email:v.value,phone:c.value,password:C.value,picture:u.value},d.value,a.clientToEdit.id??null),U.value?(E.success(G.value),j(),d.value==="post"?p("success",!1):p("success",!0),p("close")):E.error(G.value)};return ve(()=>a.clientToEdit,()=>{a.clientToEdit.id?(e.value=a.clientToEdit.name,v.value=a.clientToEdit.email,c.value=a.clientToEdit.phone,f.value=y+a.clientToEdit.picture):j()}),(T,i)=>(b(),R(Le,{open:_.open,onClose:i[8]||(i[8]=w=>T.$emit("close")),title:o(N)},{default:m(()=>[s("form",{onSubmit:ke(Y,["prevent"])},[s("div",ut,[s("div",it,[n(Q,{class:"w-full",id:"name",label:"Name",placeholder:"Name",type:"text",value:e.value,onChange:i[0]||(i[0]=w=>e.value=w),errors:o(x).name,reset:g.value,onReset:i[1]||(i[1]=()=>g.value=!1)},null,8,["value","errors","reset"]),n(Q,{class:"w-full",id:"email",label:"Email",placeholder:"Email",type:"email",value:v.value,onChange:i[2]||(i[2]=w=>v.value=w),errors:o(x).email,reset:g.value,onReset:i[3]||(i[3]=()=>g.value=!1)},null,8,["value","errors","reset"])]),s("div",ct,[n(Q,{class:"w-full",id:"phone",label:"Phone",placeholder:"Phone",type:"tel",value:c.value,onChange:i[4]||(i[4]=w=>c.value=w),errors:o(x).phone,reset:g.value,onReset:i[5]||(i[5]=()=>g.value=!1)},null,8,["value","errors","reset"]),n(Q,{class:"w-full",id:"password",label:"Password",placeholder:"Password",type:"password",onChange:i[6]||(i[6]=w=>C.value=w),errors:o(x).password,reset:g.value,onReset:i[7]||(i[7]=()=>g.value=!1)},null,8,["errors","reset"])]),s("div",null,[n(Fe,{text:"Picture",id:"profile-picture"}),s("div",dt,[s("img",{class:"relative h-20 w-20 rounded-full border object-cover",src:f.value,alt:"Profile Picture"},null,8,vt),s("div",null,[pt,s("input",{ref:"temp",onChange:M,type:"file",id:"profile-picture",class:"hidden"},null,544)])]),o(x).picture?(b(),R(Oe,{key:0,errors:o(x).picture},null,8,["errors"])):we("",!0)])]),s("div",ft,[n(Ve,{type:"submit",text:o(A),loading:o(L)},null,8,["text","loading"])])],40,nt)]),_:1},8,["open","title"]))}}),yt={class:"relative mt-6 flex-1 space-y-6 px-4 sm:px-6"},gt=le({__name:"FilterClients",props:{open:{type:Boolean},filters:null},emits:["close","reset","filter"],setup(_,{emit:p}){const a=_,e=r(!1);pe(async()=>{var u,d;a.filters.dates&&(v.value=[new Date((u=a.filters.dates)==null?void 0:u[0]),new Date((d=a.filters.dates)==null?void 0:d[1])]),a.filters.trash&&(e.value=a.filters.trash.toString()=="true")});const v=r([]),c=()=>{var d,y,q,f;const u={trash:e.value,dates:[((y=(d=v.value)==null?void 0:d[0])==null?void 0:y.toISOString().slice(0,10))??null,((f=(q=v.value)==null?void 0:q[1])==null?void 0:f.toISOString().slice(0,10))??null]};p("filter",u)},C=()=>{e.value=!1,v.value=[],p("reset")};return(u,d)=>(b(),R(ze,{filter:c,reset:C,open:_.open,onClose:d[2]||(d[2]=y=>u.$emit("close"))},{default:m(()=>[s("div",yt,[n(Ge,{label:"Trash",value:e.value,onChange:d[0]||(d[0]=y=>e.value=y)},null,8,["value"]),n(Ke,{onUpdate:d[1]||(d[1]=y=>v.value=y),dates:v.value},null,8,["dates"])])]),_:1},8,["open"]))}}),_t={class:"mb-3 flex flex-col justify-between gap-3 sm:flex-row-reverse"},ht={class:"flex justify-end sm:justify-start"},bt={class:"flex flex-1 gap-3"},xt={class:"w-full max-w-sm"},$t=s("label",{for:"search",class:"sr-only"},"Search",-1),Ct={class:"relative rounded-md shadow-sm"},qt={class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},wt=s("span",null,"Filter",-1),kt={class:"flex items-center gap-2"},Tt={class:"h-10 w-10 flex-shrink-0"},Dt=["src"],Et={class:"font-medium text-gray-900"},It={class:"text-gray-500"},Rt=["onClick"],St=["onClick"],Pt=["onClick"],Mt=["onClick"],Nt={key:1},At=s("p",{class:"p-6 text-center text-xl"},"No clients yet",-1),da=le({__name:"Clients",setup(_){Te({title:`Clients | ${et}`});const{setTitle:p}=tt();p("Clients");const a=Ie(),e=r({page:isNaN(Number(a.query.page))?null:Number(a.query.page),query:a.query.query??null,trash:a.query.trash,dates:a.query.from&&a.query.to?[a.query.from,a.query.to]:null,paginate:!0}),v=X(()=>e.value.query||e.value.trash||e.value.dates),{load:c,isLoading:C,paginatedClients:u}=at(e),d=async t=>{Object.keys(a.query).length?t?await c():H.push({query:{}}):await c()},y=r([]);pe(async()=>{await c();const{load:t,departments:l}=st();await t(),y.value=l.value.map(h=>({name:h.name,value:h.id.toString()}))});const q=r(!1),f=r(!1),M=r(""),g=r(""),N=r(""),A=r(""),E=r(""),B=r(""),L=r({}),U=r({}),x=r(!1),G=()=>{j.value={},q.value=!0},j=r({}),Y=t=>{j.value=t,q.value=!0},T=r({}),i=t=>{T.value=t,f.value=!0,M.value="Delete Client",g.value="Are you sure you want to delete this client?",N.value="Delete",A.value="bg-red-100",E.value="bg-red-600 hover:bg-red-700 focus:ring-red-500",B.value="text-red-600",L.value=ce,U.value=_e},w=t=>{T.value=t,f.value=!0,M.value="Permanent Delete Client",g.value="Are you sure you want to permanently delete this client? This action cannot be undone.",N.value="Delete",A.value="bg-red-100",E.value="bg-red-600 hover:bg-red-700 focus:ring-red-500",B.value="text-red-600",L.value=ce,U.value=he},oe=r({}),me=t=>{oe.value=t,f.value=!0,M.value="Restore Client",g.value="Are you sure you want to restore this client?",N.value="Restore",A.value="bg-teal-100",E.value="bg-teal-600 hover:bg-teal-700 focus:ring-teal-500",B.value="text-teal-600",L.value=Ze,U.value=be},O=de(),{destroy:re,restore:ye,isLoading:ge,message:V,isSuccess:Z}=fe(),_e=async()=>{await re(T.value.id),f.value=!1,Z.value?(O.success(V.value),await c()):O.error(V.value)},he=async()=>{await re(T.value.id,!0),f.value=!1,Z.value?(O.success(V.value),await c()):O.error(V.value)},be=async()=>{await ye(oe.value.id),f.value=!1,Z.value?(O.success(V.value),await c()):O.error(V.value)},xe=["Client","Tickets","Created At",""],$e={}.VITE_API_URL,H=Re(),ee=r(e.value.query??"");ve(ee,He(async function(t){var h,I;e.value.query=t;const l={};t&&(l.query=t),e.value.trash&&(l.trash=e.value.trash),(h=e.value.dates)!=null&&h[0]&&((I=e.value.dates)!=null&&I[1])&&(l.from=e.value.dates[0],l.to=e.value.dates[1]),H.push({query:l})},300));const Ce=async t=>{var h,I;x.value=!1,e.value={...t,query:e.value.query,paginate:!0};const l={};l.trash=t.trash,e.value.query&&(l.query=e.value.query),(h=t.dates)!=null&&h[0]&&((I=t.dates)!=null&&I[1])&&(l.from=t.dates[0],l.to=t.dates[1]),H.push({query:l})},qe=async()=>{var t,l;if(x.value=!1,e.value.trash||(t=e.value.dates)!=null&&t[0]&&((l=e.value.dates)!=null&&l[1])){const h={};e.value.query?(e.value={query:e.value.query,paginate:!0},h.query=e.value.query):e.value={paginate:!0},H.push({query:h})}};return De(async(t,l)=>{t.query.page!==l.query.page&&(e.value={...e.value,page:Number(t.query.page)}),await c()}),(t,l)=>{var ne;const h=Pe("router-link"),I=Me("tooltip");return b(),F(J,null,[n(mt,{open:q.value,departments:y.value,"client-to-edit":j.value,onClose:l[0]||(l[0]=k=>q.value=!1),onSuccess:d},null,8,["open","departments","client-to-edit"]),n(Ue,{title:M.value,open:f.value,text:g.value,"button-text":N.value,"is-loading":o(ge),Icon:L.value,color:B.value,"background-color":A.value,onClose:l[1]||(l[1]=k=>f.value=!1),onConfirm:l[2]||(l[2]=k=>U.value()),"button-background-color":E.value},null,8,["title","open","text","button-text","is-loading","Icon","color","background-color","button-background-color"]),n(gt,{departments:y.value,filters:e.value,open:x.value,onClose:l[3]||(l[3]=k=>x.value=!1),onFilter:Ce,onReset:qe},null,8,["departments","filters","open"]),s("header",_t,[s("div",ht,[n(Qe,{Icon:o(We),text:"New Client",action:G},null,8,["Icon"])]),s("div",bt,[s("div",xt,[$t,s("div",Ct,[s("div",qt,[n(o(Ye),{class:"h-5 w-5 text-gray-400"})]),ue(s("input",{"onUpdate:modelValue":l[4]||(l[4]=k=>ee.value=k),type:"search",name:"search",id:"search",class:"block w-full rounded-md border-gray-300 pl-10 text-sm focus:border-teal-500 focus:ring-teal-500",placeholder:"Search"},null,512),[[Ee,ee.value]])])]),s("button",{onClick:l[5]||(l[5]=k=>x.value=!0),type:"button",class:"relative -ml-px inline-flex items-center space-x-2 rounded-md border border-gray-300 bg-gray-50 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 focus:border-teal-500 focus:outline-none focus:ring-1 focus:ring-teal-500"},[n(o(Je),{class:"h-5 w-5 text-gray-400"}),wt])])]),o(C)?(b(),R(Be,{key:0})):!o(C)&&!((ne=o(u).data)!=null&&ne.length)&&o(v)?(b(),R(Xe,{key:1,text:"No clients related to your search"})):(b(),R(Ne,{key:2,headers:xe},{default:m(()=>{var k;return[(k=o(u).data)!=null&&k.length?(b(!0),F(J,{key:0},Se(o(u).data,$=>(b(),F("tr",{key:$.id},[n(z,null,{default:m(()=>[s("div",kt,[s("div",Tt,[s("img",{class:"h-10 w-10 rounded-full",src:o($e)+$.picture,alt:"Profile Picture"},null,8,Dt)]),s("div",null,[s("div",Et,K($.name),1),s("div",It,K($.email),1)])])]),_:2},1024),n(z,null,{default:m(()=>[ue((b(),R(h,{to:{name:"DashboardTickets",query:{client:$.id}}},{default:m(()=>[ie(K($.tickets_count),1)]),_:2},1032,["to"])),[[I,`See ${$.name}'s tickets`,void 0,{bottom:!0}]])]),_:2},1024),n(z,null,{default:m(()=>[ie(K($.created_at),1)]),_:2},1024),n(z,null,{default:m(()=>[n(je,null,{default:m(()=>[t.$route.query.trash!="true"?(b(),F(J,{key:0},[n(o(W),{class:"cursor-pointer"},{default:m(()=>[s("div",{onClick:te=>Y($),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," Edit ",8,Rt)]),_:2},1024),n(o(W),{class:"cursor-pointer"},{default:m(()=>[s("div",{onClick:te=>i($),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," Delete ",8,St)]),_:2},1024)],64)):(b(),F(J,{key:1},[n(o(W),{class:"cursor-pointer"},{default:m(()=>[s("div",{onClick:te=>me($),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," Restore ",8,Pt)]),_:2},1024),n(o(W),{class:"cursor-pointer"},{default:m(()=>[s("div",{onClick:te=>w($),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," Delete permanently ",8,Mt)]),_:2},1024)],64))]),_:2},1024)]),_:2},1024)]))),128)):(b(),F("tr",Nt,[n(z,{colspan:"5"},{default:m(()=>[At]),_:1})]))]}),pagination:m(()=>[n(Ae,{class:"border-t bg-gray-50 py-2 px-3",from:o(u).from,to:o(u).to,total:o(u).total,prev_page_url:o(u).prev_page_url,next_page_url:o(u).next_page_url,links:o(u).links,"route-name":"DashboardClients",query:{trash:t.$route.query.trash,query:t.$route.query.query,department:t.$route.query.department,role:t.$route.query.role,from:t.$route.query.from,to:t.$route.query.to}},null,8,["from","to","total","prev_page_url","next_page_url","links","query"])]),_:1}))],64)}}});export{da as default};
