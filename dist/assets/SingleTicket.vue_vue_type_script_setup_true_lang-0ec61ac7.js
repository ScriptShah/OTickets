import{_ as q}from"./_plugin-vue_export-helper-c27b6911.js";import{o as s,c as r,g as e,F as j,x as I,p as G,d as R,a as l,h as a,C as b,t as M,m as $,A as C,e as H,s as O,G as S,b as d,q as Q,f as te,I as se,i as h,T as ae,y as ne,l as le,k as oe,z as re,u as ce}from"./index-28d7808a.js";import{_ as P}from"./SectionHeader.vue_vue_type_script_setup_true_lang-7b13873f.js";import{_ as ie}from"./TicketInfo.vue_vue_type_script_setup_true_lang-89dffe83.js";import{_ as de}from"./Autocomplete.vue_vue_type_script_setup_true_lang-30be75d0.js";import{_ as ue,u as ve}from"./useTickets-30744fb3.js";import{_ as fe}from"./RichText.vue_vue_type_script_setup_true_lang-e94a215b.js";import{_ as pe}from"./ActionButton.vue_vue_type_script_setup_true_lang-a5ee823d.js";import{g as me}from"./getCannedResponses-3bd3d524.js";import{a as he,V as ge,X as _e,Q as ye}from"./index-ee44951e.js";import{g as xe,S as we,b as ke,M as D}from"./menu-880c2858.js";import{a as be}from"./global-6426d760.js";import{n as $e}from"./notFound-78fb0959.js";const Ce={},Re={class:"animate-pulse divide-y rounded-lg border shadow"},Ae=G('<div class="p-3"><div class="flex flex-wrap items-center justify-between gap-3"><div class="w-full flex-1"><div class="h-7 w-full rounded bg-gray-200"></div><div class="mt-2 h-3 w-96 max-w-full rounded bg-gray-200"></div></div><div class="h-5 w-24 rounded-full bg-gray-200"></div></div></div><div class="px-3 py-5"><div class="h-52 w-full rounded bg-gray-200"></div></div>',2),Te={class:"p-3"},Le=e("div",{class:"flex items-center gap-1 font-semibold text-gray-500"},[e("div",{class:"h-4 w-40 max-w-full rounded bg-gray-200"})],-1),Me={class:"mt-3 flex flex-wrap gap-3"},Se=e("div",{class:"h-20 w-20 rounded-lg border bg-gray-200"},null,-1),je=[Se];function Ie(t,n){return s(),r("div",Re,[Ae,e("div",Te,[Le,e("div",Me,[(s(),r(j,null,I(4,o=>e("div",{key:o},je)),64))])])])}const Be=q(Ce,[["render",Ie]]);function Ve(t,n){return s(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18.375 12.739l-7.693 7.693a4.5 4.5 0 01-6.364-6.364l10.94-10.94A3 3 0 1119.5 7.372L8.552 18.32m.009-.01l-.01.01m5.699-9.941l-7.81 7.81a1.5 1.5 0 002.112 2.13"})])}const Ne={class:"flex items-center gap-1 font-semibold text-gray-500"},ze=e("h2",null,"Attachments",-1),He={class:"mt-3 flex flex-wrap gap-3"},Pe=["href"],Ue=["src","alt"],X=R({__name:"Attachments",props:{attachments:null},setup(t){const n={}.VITE_API_URL;return(o,c)=>(s(),r("div",null,[e("div",Ne,[l(a(Ve),{class:"h-4 w-4"}),ze]),e("div",He,[(s(!0),r(j,null,I(t.attachments,i=>(s(),r("a",{key:i.id,href:a(n)+i.path,target:"_blank"},[e("img",{src:a(n)+i.path,alt:i.filename,class:"h-20 w-20 rounded-lg border object-cover"},null,8,Ue)],8,Pe))),128))])]))}}),Fe={class:"divide-y rounded-lg border shadow"},Ee={class:"p-3"},De={class:"flex flex-wrap items-center justify-between gap-3"},qe={class:"overflow-hidden"},Ge={class:"px-3 py-5"},Oe=["innerHTML"],Qe=R({__name:"TicketCard",props:{ticket:null},setup(t){return(n,o)=>{var c,i,u,v;return s(),r("div",Fe,[e("div",Ee,[e("div",De,[e("div",qe,[l(P,{title:t.ticket.subject},null,8,["title"]),l(ie,{class:"overflow-x-auto whitespace-nowrap",reference:t.ticket.reference,priority:t.ticket.priority,"created-at":t.ticket.created_at,"category-name":(c=t.ticket.category)==null?void 0:c.name,"last-reply-on":(u=(i=t.ticket.replies)==null?void 0:i[0])==null?void 0:u.created_at},null,8,["reference","priority","created-at","category-name","last-reply-on"])]),e("div",null,[e("span",{class:b(["rounded-full px-3 py-px text-sm",{"bg-indigo-100 text-indigo-800":t.ticket.status==="assigned","bg-gray-100 text-gray-800":t.ticket.status==="unassigned","bg-red-100 text-red-800":t.ticket.status==="closed","bg-green-100 text-green-800":t.ticket.status==="resolved"}])},M(t.ticket.status),3)])])]),e("div",Ge,[e("article",{class:"prose max-w-none space-y-0 prose-headings:mb-0",innerHTML:t.ticket.description},null,8,Oe)]),(v=t.ticket.attachments)!=null&&v.length?(s(),$(X,{key:0,class:"p-3",attachments:t.ticket.attachments},null,8,["attachments"])):C("",!0)])}}}),Xe={},Ye={class:"animate-pulse divide-y rounded-lg border shadow"},Je=G('<div class="p-3"><div class="flex gap-1"><div class="h-14 w-14 rounded-full bg-gray-200"></div><div><div class="h-4 w-64 max-w-full rounded bg-gray-200"></div><div class="mt-2 h-3 w-52 max-w-full rounded bg-gray-200"></div></div></div><div class="mt-1 h-32 w-full rounded bg-gray-200"></div></div>',1),Ke=[Je];function We(t,n){return s(),r("div",Ye,Ke)}const Ze=q(Xe,[["render",We]]),et={class:"divide-y rounded-lg border shadow"},tt={class:"flex gap-2 p-3"},st={class:"rounded-full"},at=["src"],nt={class:"text-sm"},lt={class:"text-xs text-gray-500"},ot={key:0},rt=["innerHTML"],ct=R({__name:"Reply",props:{reply:null},setup(t){const n=t,o={}.VITE_API_URL,c=H(),{user:i}=O(c),u=S(()=>n.reply.user.id==i.value.id?"You":n.reply.user.name),v=S(()=>n.reply.user.role=="agent"),_=S(()=>o+n.reply.user.picture);return(A,y)=>{var f;return s(),r("div",et,[e("div",tt,[e("div",st,[e("img",{src:a(_),alt:"Profile Picture",class:"h-14 w-14 rounded-full border object-cover"},null,8,at)]),e("div",null,[e("div",nt,M(a(u)),1),e("div",lt,[a(v)?(s(),r("div",ot,M((f=t.reply.user.department)==null?void 0:f.name),1)):C("",!0),e("div",null,M(t.reply.created_at),1)])])]),e("article",{class:"prose max-w-none space-y-0 px-3 py-5 prose-headings:mb-0",innerHTML:t.reply.content},null,8,rt),t.reply.attachments.length?(s(),$(X,{key:0,class:"p-3",attachments:t.reply.attachments},null,8,["attachments"])):C("",!0)])}}});function it(t,n){return s(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M11.47 7.72a.75.75 0 011.06 0l7.5 7.5a.75.75 0 11-1.06 1.06L12 9.31l-6.97 6.97a.75.75 0 01-1.06-1.06l7.5-7.5z","clip-rule":"evenodd"})])}function dt(t,n){return s(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M12.53 16.28a.75.75 0 01-1.06 0l-7.5-7.5a.75.75 0 011.06-1.06L12 14.69l6.97-6.97a.75.75 0 111.06 1.06l-7.5 7.5z","clip-rule":"evenodd"})])}function ut(t,n){return s(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184"})])}const vt={class:"space-y-3 px-3 pb-3 pt-6"},ft={key:0,class:"flex items-end gap-3"},pt={class:"flex justify-end bg-gray-50 p-3"},mt={class:"relative z-0 inline-flex rounded-md shadow-sm"},ht=e("span",{class:"sr-only"},"Open options",-1),gt={class:"divide-y"},_t=R({__name:"NewReply",props:{ticketId:null},emits:["reload"],setup(t,{emit:n}){const o=t,c=H(),{isAgent:i}=O(c),u=d(""),v=d([]),_=d([]),{load:A,cannedResponses:y}=me();Q(async()=>{i.value&&(await A(),_.value=y.value.map(w=>({name:w.title,value:w.content})))});const f=d({}),x=S(()=>{var w;return((w=f.value)==null?void 0:w.value)??null}),{copy:g,copied:p}=he({source:x}),{reply:T,isLoading:Y,isSuccess:J,message:U,errors:B}=ve(),F=te(),V=d(!1),N=d(!1),K=()=>{F.success(U.value),v.value=[],u.value="",V.value=!0,N.value=!0,n("reload")},L=d(""),z=async()=>{Y.value||(V.value=!1,N.value=!1,await T({action:L.value,ticket_id:o.ticketId,content:u.value,attachments:v.value}),J.value?K():F.error(U.value))},W=()=>{L.value="reply",z()},Z=()=>{L.value="resolve",z()},ee=()=>{L.value="close",z()};return se(()=>{B.value={}}),(w,k)=>(s(),$(a(ye),{as:"form"},{default:h(({open:E})=>[l(a(ge),{class:b([E?"rounded-t-lg":"rounded-lg","flex w-full items-center justify-between border border-b-0 bg-gray-50 px-3 py-4 text-left shadow"])},{default:h(()=>[l(P,{title:"New Reply"}),l(a(it),{class:b([E?"rotate-180 transform":"","h-5 w-5 text-gray-500"])},null,8,["class"])]),_:2},1032,["class"]),l(a(_e),{class:"divide-y rounded-b-lg border shadow"},{default:h(()=>[e("div",vt,[a(i)?(s(),r("div",ft,[l(de,{class:"max-w-sm flex-1","null-text":"Select a canned response",label:"Canned Response",options:_.value,onUpdate:k[0]||(k[0]=m=>f.value=m)},null,8,["options"]),e("div",null,[l(pe,{text:a(p)?"Copied":"Copy",action:a(g),Icon:a(ut)},null,8,["text","action","Icon"])])])):C("",!0),l(fe,{onChange:k[1]||(k[1]=m=>u.value=m),placeholder:"Reply to this ticket",value:u.value,errors:a(B).content,"reset-content":N.value},null,8,["value","errors","reset-content"]),l(ue,{onChange:k[2]||(k[2]=m=>v.value=m),label:"Drop attachments here or click to browse",multiple:"",errors:a(B).attachments,"reset-files":V.value},null,8,["errors","reset-files"])]),e("div",pt,[e("div",mt,[e("button",{onClick:W,type:"button",class:"relative inline-flex items-center rounded-l-md border border-teal-700 bg-teal-600 px-4 py-2 font-medium text-white hover:bg-teal-700 focus:z-10 focus:border-teal-700 focus:outline-none focus:ring-1 focus:ring-teal-700"}," Reply "),l(a(xe),{as:"span",class:"relative -ml-px block"},{default:h(()=>[l(a(we),{class:"hover:teal-700 relative inline-flex items-center rounded-r-md border border-teal-700 bg-teal-600 px-2 py-2 font-medium text-white focus:z-10 focus:border-teal-700 focus:outline-none focus:ring-1 focus:ring-teal-700"},{default:h(()=>[ht,l(a(dt),{class:"h-6 w-6"})]),_:1}),l(ae,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:h(()=>[l(a(ke),{class:"absolute right-0 mt-2 -mr-1 w-60 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{default:h(()=>[e("div",gt,[l(a(D),{class:"cursor-pointer",onClick:Z},{default:h(({active:m})=>[e("div",{class:b([m?"bg-gray-100 text-gray-900":"text-gray-700","block px-4 py-3 text-sm"])}," Reply and Mark as Resolved ",2)]),_:1}),l(a(D),{class:"cursor-pointer",onClick:ee},{default:h(({active:m})=>[e("div",{class:b([m?"bg-gray-100 text-gray-900":"text-gray-700","block px-4 py-3 text-sm"])}," Reply and Mark as Closed ",2)]),_:1})])]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1}))}}),yt=async t=>{const n=d({}),o=d(!1),c=d(!1);return await ne.get(`/tickets/${t}`).then(i=>{n.value=i.data.data,c.value=!1}).catch(()=>o.value=!0),{ticket:n,error:o,isLoading:c}},xt={key:0},wt={key:1,id:"conversation"},kt={class:"space-y-4"},Nt=R({__name:"SingleTicket",props:{customClass:null},setup(t){const n=le(),o=d({}),c=d(!0),i=d(!1),{user:u,isClient:v}=H(),_=d(!1),A=oe(),y=async(f=!1,x=n.params.reference)=>{var p,T;c.value=!0;const g=await yt(x);g.error.value&&$e(n),o.value=g.ticket.value,c.value=g.isLoading.value,_.value=((T=(p=o.value.agents)==null?void 0:p[0])==null?void 0:T.id)===u.id,i.value=o.value.status!=="resolved"&&o.value.status!=="closed",ce({title:`${o.value.subject} | ${be}`}),f&&A.push({hash:"#conversation"})};return Q(async()=>{await y(!1)}),re(async f=>{await y(!1,f.params.reference)}),(f,x)=>{var g;return s(),r("section",{class:b([t.customClass,"space-y-6"])},[e("div",null,[c.value?(s(),$(Be,{key:0})):(s(),$(Qe,{key:1,ticket:o.value},null,8,["ticket"]))]),!c.value&&i.value&&(_.value||a(v))?(s(),r("div",xt,[l(_t,{"ticket-id":o.value.id,onReload:x[0]||(x[0]=p=>y(!0))},null,8,["ticket-id"])])):C("",!0),c.value||(g=o.value.replies)!=null&&g.length?(s(),r("div",wt,[l(P,{title:"Conversation",class:"mb-2"}),e("div",kt,[c.value?(s(),r(j,{key:0},I(3,p=>l(Ze,{key:p})),64)):(s(!0),r(j,{key:1},I(o.value.replies,p=>(s(),$(ct,{reply:p,key:p.id},null,8,["reply"]))),128))])])):C("",!0)],2)}}});export{Nt as _};
