import{b as s,y as te,d as ae,G as J,f as ue,E as K,m as C,i as d,h as r,o as y,g as m,a as l,w as Ce,q as ie,u as we,z as Te,c as q,n as O,v as De,F as G,l as Ne,k as Se,x as Ee,j as V,t as $,r as Me,B as Re}from"./index-28d7808a.js";import{_ as Be,a as D,b as Ie,T as Ae}from"./TableSkeleton-b5bcf82c.js";import{_ as je,a as Le,b as Ue,r as le}from"./ExclamationTriangleIcon-54e3cae4.js";import{_ as ne,a as Ve}from"./PrimaryButton.vue_vue_type_script_setup_true_lang-a98f89af.js";import{_ as de}from"./Autocomplete.vue_vue_type_script_setup_true_lang-30be75d0.js";import{_ as Fe,a as Oe,d as Pe,r as He}from"./debounce-fafd0e7f.js";import{_ as ze}from"./ActionButton.vue_vue_type_script_setup_true_lang-a5ee823d.js";import{r as Ge,_ as Qe}from"./PlusIcon-1afde447.js";import{r as Je}from"./MagnifyingGlassIcon-7b7d515e.js";import{r as Ke}from"./InformationCircleIcon-4d06df1d.js";import{a as We}from"./global-6426d760.js";import{u as Xe}from"./dashboard-51967606.js";import{g as Ye}from"./getCategories-ebf7ea6c.js";import{g as Ze}from"./getDepartments-3ecae0aa.js";import{M as Q}from"./menu-880c2858.js";import"./ChevronRightIcon-af9613bc.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./EllipsisHorizontalIcon-f2ab61ca.js";import"./SectionHeader.vue_vue_type_script_setup_true_lang-7b13873f.js";import"./XMarkIcon-cf8614b7.js";import"./transition-d11ecd8d.js";import"./use-tracked-pointer-3831155a.js";import"./dialog-4ee4193f.js";import"./FormLabel.vue_vue_type_script_setup_true_lang-7c85f56e.js";import"./vue.runtime.esm-bundler-e8cc2f2c.js";import"./combobox-f45cc6e0.js";import"./use-controllable-fce04192.js";import"./switch-6008f224.js";import"./emptyResults-4bcd933a.js";const ee=s({}),M=s(""),R=s(!1),B=s(!1),et=async(_,g,t=null)=>{ee.value={},R.value=!0,B.value=!1;const e=t?`/categories/${t}`:"/categories";await te.post(e,{..._,_method:g}).then(c=>{M.value=c.data.message,B.value=!0}).catch(c=>{var i;ee.value=(i=c.response)==null?void 0:i.data.errors,M.value="Please check the errors"}).then(()=>R.value=!1)},tt=async _=>{R.value=!0,B.value=!1,await te.put(`/categories/${_}/restore`).then(g=>{M.value=g.data.message,B.value=!0}).catch(g=>{var t;M.value=(t=g.response)==null?void 0:t.data.message}).then(()=>R.value=!1)},at=async(_,g=!1)=>{R.value=!0,B.value=!1;const t=g?`/categories/${_}/force-delete`:`/categories/${_}`;await te.delete(t).then(e=>{M.value=e.data.message,B.value=!0}).catch(e=>{var c;M.value=(c=e.response)==null?void 0:c.data.message}).then(()=>R.value=!1)},ce=()=>({errors:ee,isLoading:R,isSuccess:B,message:M,save:et,destroy:at,restore:tt}),st=["onSubmit"],ot={class:"space-y-4 p-6"},rt={class:"mt-3 flex justify-end border-t bg-gray-50 px-6 py-3"},lt=ae({__name:"CategoryModal",props:{open:{type:Boolean},departments:null,categoryToEdit:null},emits:["close","success"],setup(_,{emit:g}){const t=_,e=s(""),c=s(""),i=s({}),w=J(()=>t.categoryToEdit.id?"put":"post"),v=s(!1),F=J(()=>t.categoryToEdit.id?"Edit Category":"New Category"),h=J(()=>t.categoryToEdit.id?"Update":"Create"),p=ue(),{save:f,isLoading:I,isSuccess:A,errors:T,message:N}=ce(),S=()=>{v.value=!0,e.value="",c.value="",i.value={}},j=async()=>{var n,b;const x=isNaN(Number((n=i.value)==null?void 0:n.value))?null:Number((b=i.value)==null?void 0:b.value);await f({name:e.value,slug:c.value,department_id:x},w.value,t.categoryToEdit.id??null),A.value?(p.success(N.value),S(),w.value==="post"?g("success",!1):g("success",!0),g("close")):p.error(N.value)};return K(()=>t.categoryToEdit,()=>{t.categoryToEdit.id?(e.value=t.categoryToEdit.name,c.value=t.categoryToEdit.slug):S()}),K(()=>t.departments&&t.categoryToEdit,()=>{t.categoryToEdit.id&&(i.value=t.departments.find(x=>{var n;return x.value===((n=t.categoryToEdit.department)==null?void 0:n.id.toString())})??{})}),(x,n)=>(y(),C(je,{open:_.open,onClose:n[6]||(n[6]=b=>x.$emit("close")),title:r(F)},{default:d(()=>[m("form",{onSubmit:Ce(j,["prevent"])},[m("div",ot,[l(ne,{class:"w-full",id:"name",label:"Name",placeholder:"Name",type:"text",value:e.value,onChange:n[0]||(n[0]=b=>e.value=b),errors:r(T).name,reset:v.value,onReset:n[1]||(n[1]=()=>v.value=!1)},null,8,["value","errors","reset"]),l(ne,{class:"w-full",id:"slug",label:"Slug",placeholder:"Slug",type:"text",value:c.value,onChange:n[2]||(n[2]=b=>c.value=b),errors:r(T).slug,reset:v.value,onReset:n[3]||(n[3]=()=>v.value=!1)},null,8,["value","errors","reset"]),l(de,{"null-text":"Select a department",class:"w-full",label:"Department",selected:i.value,options:_.departments,onUpdate:n[4]||(n[4]=b=>i.value=b),errors:r(T).department_id,reset:v.value,onReset:n[5]||(n[5]=()=>v.value=!1)},null,8,["selected","options","errors","reset"])]),m("div",rt,[l(Ve,{type:"submit",text:r(h),loading:r(I)},null,8,["text","loading"])])],40,st)]),_:1},8,["open","title"]))}}),nt={class:"relative mt-6 flex-1 space-y-6 px-4 sm:px-6"},ut=ae({__name:"FilterCategories",props:{open:{type:Boolean},filters:null,departments:null},emits:["close","reset","filter"],setup(_,{emit:g}){const t=_,e=s({}),c=s({}),i=s(!1);ie(async()=>{t.filters.trash&&(i.value=t.filters.trash.toString()=="true")}),K(()=>t.departments,()=>{t.filters.department&&(c.value=t.departments.find(h=>{var p;return h.value===((p=t.filters.department)==null?void 0:p.toString())}))});const w=s([]),v=()=>{var f;const h=(f=c.value)==null?void 0:f.value,p={trash:i.value,department:h};g("filter",p)},F=()=>{i.value=!1,e.value={},c.value={},w.value=[],g("reset")};return(h,p)=>(y(),C(Fe,{filter:v,reset:F,open:_.open,onClose:p[2]||(p[2]=f=>h.$emit("close"))},{default:d(()=>[m("div",nt,[l(Oe,{label:"Trash",value:i.value,onChange:p[0]||(p[0]=f=>i.value=f)},null,8,["value"]),l(de,{onUpdate:p[1]||(p[1]=f=>c.value=f),label:"Department",options:_.departments,selected:c.value,"null-text":"All"},null,8,["options","selected"])])]),_:1},8,["open"]))}}),it={class:"mb-3 flex flex-col justify-between gap-3 sm:flex-row-reverse"},dt={class:"flex justify-end sm:justify-start"},ct={class:"flex flex-1 gap-3"},vt={class:"w-full max-w-sm"},pt=m("label",{for:"search",class:"sr-only"},"Search",-1),mt={class:"relative rounded-md shadow-sm"},ft={class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},yt=m("span",null,"Filter",-1),gt={key:1},_t={key:1},bt={key:1},ht=["onClick"],xt=["onClick"],kt=["onClick"],qt=["onClick"],$t={key:1},Ct=m("p",{class:"p-6 text-center text-xl"},"No categories yet",-1),ta=ae({__name:"Categories",setup(_){we({title:`Categories | ${We}`});const{setTitle:g}=Xe();g("Categories");const t=Ne(),e=s({page:isNaN(Number(t.query.page))?null:Number(t.query.page),query:t.query.query??null,department:isNaN(Number(t.query.department))?null:Number(t.query.department),trash:t.query.trash,paginate:!0}),c=J(()=>e.value.query||e.value.department||e.value.trash),{load:i,isLoading:w,paginatedCategories:v}=Ye(e),F=async a=>{Object.keys(t.query).length?a?await i():H.push({query:{}}):await i()},h=s([]);ie(async()=>{await i();const{load:a,departments:o}=Ze();await a(),h.value=o.value.map(E=>({name:E.name,value:E.id.toString()}))});const p=s(!1),f=s(!1),I=s(""),A=s(""),T=s(""),N=s(""),S=s(""),j=s(""),x=s({}),n=s({}),b=s(!1),ve=()=>{W.value={},p.value=!0},W=s({}),pe=a=>{W.value=a,p.value=!0},P=s({}),me=a=>{P.value=a,f.value=!0,I.value="Delete Category",A.value="Are you sure you want to delete this category?",T.value="Delete",N.value="bg-red-100",S.value="bg-red-600 hover:bg-red-700 focus:ring-red-500",j.value="text-red-600",x.value=le,n.value=be},fe=a=>{P.value=a,f.value=!0,I.value="Permanent Delete Category",A.value="Are you sure you want to permanently delete this category? This action cannot be undone.",T.value="Delete",N.value="bg-red-100",S.value="bg-red-600 hover:bg-red-700 focus:ring-red-500",j.value="text-red-600",x.value=le,n.value=he},se=s({}),ye=a=>{se.value=a,f.value=!0,I.value="Restore Category",A.value="Are you sure you want to restore this category?",T.value="Restore",N.value="bg-teal-100",S.value="bg-teal-600 hover:bg-teal-700 focus:ring-teal-500",j.value="text-teal-600",x.value=Ke,n.value=xe},L=ue(),{destroy:oe,restore:ge,isLoading:_e,message:U,isSuccess:X}=ce(),be=async()=>{await oe(P.value.id),f.value=!1,X.value?(L.success(U.value),await i()):L.error(U.value)},he=async()=>{await oe(P.value.id,!0),f.value=!1,X.value?(L.success(U.value),await i()):L.error(U.value)},xe=async()=>{await ge(se.value.id),f.value=!1,X.value?(L.success(U.value),await i()):L.error(U.value)},ke=["Category","Department","Tickets","Faqs","Canned Responses","Created At",""],H=Se(),Y=s(e.value.query??"");K(Y,Pe(async function(a){e.value.query=a;const o={};a&&(o.query=a),e.value.trash&&(o.trash=e.value.trash),e.value.department&&(o.department=e.value.department),H.push({query:o})},300));const qe=async a=>{b.value=!1,e.value={...a,query:e.value.query,paginate:!0};const o={};o.trash=a.trash,e.value.query&&(o.query=e.value.query),a.department&&(o.department=a.department),!e.value.query&&!a.trash&&!a.department&&(w.value=!1),H.push({query:o})},$e=async()=>{if(b.value=!1,e.value.trash||e.value.department){const a={};e.value.query?(e.value={query:e.value.query,paginate:!0},a.query=e.value.query):e.value={paginate:!0},H.push({query:a})}};return Te(async(a,o)=>{a.query.page!==o.query.page&&(e.value={...e.value,page:Number(a.query.page)}),await i()}),(a,o)=>{var re;const E=Me("router-link"),z=Re("tooltip");return y(),q(G,null,[l(lt,{open:p.value,departments:h.value,"category-to-edit":W.value,onClose:o[0]||(o[0]=k=>p.value=!1),onSuccess:F},null,8,["open","departments","category-to-edit"]),l(Le,{title:I.value,open:f.value,text:A.value,"button-text":T.value,"is-loading":r(_e),Icon:x.value,color:j.value,"background-color":N.value,onClose:o[1]||(o[1]=k=>f.value=!1),onConfirm:o[2]||(o[2]=k=>n.value()),"button-background-color":S.value},null,8,["title","open","text","button-text","is-loading","Icon","color","background-color","button-background-color"]),l(ut,{departments:h.value,filters:e.value,open:b.value,onClose:o[3]||(o[3]=k=>b.value=!1),onFilter:qe,onReset:$e},null,8,["departments","filters","open"]),m("header",it,[m("div",dt,[l(ze,{Icon:r(Ge),text:"New Category",action:ve},null,8,["Icon"])]),m("div",ct,[m("div",vt,[pt,m("div",mt,[m("div",ft,[l(r(Je),{class:"h-5 w-5 text-gray-400"})]),O(m("input",{"onUpdate:modelValue":o[4]||(o[4]=k=>Y.value=k),type:"search",name:"search",id:"search",class:"block w-full rounded-md border-gray-300 pl-10 text-sm focus:border-teal-500 focus:ring-teal-500",placeholder:"Search"},null,512),[[De,Y.value]])])]),m("button",{onClick:o[5]||(o[5]=k=>b.value=!0),type:"button",class:"relative -ml-px inline-flex items-center space-x-2 rounded-md border border-gray-300 bg-gray-50 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 focus:border-teal-500 focus:outline-none focus:ring-1 focus:ring-teal-500"},[l(r(He),{class:"h-5 w-5 text-gray-400"}),yt])])]),r(w)?(y(),C(Ae,{key:0})):!r(w)&&!((re=r(v).data)!=null&&re.length)&&r(c)?(y(),C(Qe,{key:1,text:"No categories related to your search"})):(y(),C(Be,{key:2,headers:ke},{default:d(()=>{var k;return[(k=r(v).data)!=null&&k.length?(y(!0),q(G,{key:0},Ee(r(v).data,u=>(y(),q("tr",{key:u.id},[l(D,null,{default:d(()=>[O((y(),C(E,{to:{name:"HomeCategory",params:{slug:u.slug}},target:"_blank"},{default:d(()=>[V($(u.name),1)]),_:2},1032,["to"])),[[z,"View in a new tab",void 0,{bottom:!0}]])]),_:2},1024),l(D,null,{default:d(()=>[V($(u.department.name),1)]),_:2},1024),l(D,null,{default:d(()=>[u.tickets_count?O((y(),C(E,{key:0,to:{name:"DashboardTickets",query:{category:u.id}}},{default:d(()=>[V($(u.tickets_count),1)]),_:2},1032,["to"])),[[z,`See ${u.name}'s tickets`,void 0,{bottom:!0}]]):(y(),q("span",gt,$(u.tickets_count),1))]),_:2},1024),l(D,null,{default:d(()=>[u.faqs_count?O((y(),C(E,{key:0,to:{name:"DashboardFaqs",query:{category:u.id}}},{default:d(()=>[V($(u.faqs_count),1)]),_:2},1032,["to"])),[[z,`See ${u.name}'s FAQs`,void 0,{bottom:!0}]]):(y(),q("span",_t,$(u.faqs_count),1))]),_:2},1024),l(D,null,{default:d(()=>[u.canned_responses_count?O((y(),C(E,{key:0,to:{name:"DashboardCannedResponses",query:{category:u.id}}},{default:d(()=>[V($(u.canned_responses_count),1)]),_:2},1032,["to"])),[[z,`See ${u.name}'s canned responses`,void 0,{bottom:!0}]]):(y(),q("span",bt,$(u.canned_responses_count),1))]),_:2},1024),l(D,null,{default:d(()=>[V($(u.created_at),1)]),_:2},1024),l(D,null,{default:d(()=>[l(Ue,null,{default:d(()=>[a.$route.query.trash!="true"?(y(),q(G,{key:0},[l(r(Q),{class:"cursor-pointer"},{default:d(()=>[m("div",{onClick:Z=>pe(u),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," Edit ",8,ht)]),_:2},1024),l(r(Q),{class:"cursor-pointer"},{default:d(()=>[m("div",{onClick:Z=>me(u),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," Delete ",8,xt)]),_:2},1024)],64)):(y(),q(G,{key:1},[l(r(Q),{class:"cursor-pointer"},{default:d(()=>[m("div",{onClick:Z=>ye(u),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," Restore ",8,kt)]),_:2},1024),l(r(Q),{class:"cursor-pointer"},{default:d(()=>[m("div",{onClick:Z=>fe(u),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," Delete permanently ",8,qt)]),_:2},1024)],64))]),_:2},1024)]),_:2},1024)]))),128)):(y(),q("tr",$t,[l(D,{colspan:"7"},{default:d(()=>[Ct]),_:1})]))]}),pagination:d(()=>[l(Ie,{class:"border-t bg-gray-50 py-2 px-3",from:r(v).from,to:r(v).to,total:r(v).total,prev_page_url:r(v).prev_page_url,next_page_url:r(v).next_page_url,links:r(v).links,"route-name":"DashboardCategories",query:{query:a.$route.query.query,department:a.$route.query.department,trash:a.$route.query.trash}},null,8,["from","to","total","prev_page_url","next_page_url","links","query"])]),_:1}))],64)}}});export{ta as default};
